# üßÆ Explorer une population de 100 millions de personnes‚Ä¶ pour z√©ro budget

 La statistique n‚Äôest pas r√©serv√©e aux supercalculateurs ni aux logiciels co√ªteux.

 Avec **R** et quelques packages libres, il est possible de manipuler et d‚Äôanalyser **des centaines de millions d‚Äôindividus** sur un simple ordinateur.

## Objectif du projet

G√©n√©rer une **population fictive r√©aliste** compos√©e de millions d‚Äôindividus, dot√©s de caract√©ristiques coh√©rentes


| Colonne          | Description                                    |
| ---------------- | ---------------------------------------------- |
| `prenom`         | Pr√©nom simul√© selon le sexe                    |
| `age`            | √Çge recalcul√© √† partir de la date de naissance |
| `date_naissance` | Date de naissance coh√©rente avec l‚Äô√¢ge         |
| `sexe`           | Sexe biologique simul√© (‚ÄúHomme‚Äù / ‚ÄúFemme‚Äù)     |
| `taille`         | Taille en cm, distribu√©e selon le sexe         |
| `niveau_etudes`  | Niveau d‚Äô√©tudes selon l‚Äô√¢ge                    |


L‚Äôensemble repose sur une g√©n√©ration **vectoris√©e** via [`data.table`](https://rdatatable.gitlab.io/data.table/), assurant **vitesse et efficacit√© m√©moire** m√™me sur des jeux de donn√©es g√©ants.
Les donn√©es sont ensuite analys√©s via les packages [`data.table`](https://cran.r-project.org/package=data.table) et  [`arrow`](https://cran.r-project.org/package=arrow) (parquet/dplyr)

- ‚úÖ G√©n√©ration rapide de plusieurs millions (jusqu‚Äô√† 100 M) d‚Äôindividus
- ‚úÖ Donn√©es statistiquement plausibles et coh√©rentes
- ‚úÖ Vectorisation compl√®te (aucune boucle lente)
- ‚úÖ Exports automatiques en **CSV** et **Parquet**
- ‚úÖ Syst√®me de **log** d√©taill√© (temps, √©tapes, succ√®s)


## Cr√©ation du jeu de donn√©es

- Initialisation
- D√©finition du nombre d‚Äôindividus, de la date du jour et de la graine al√©atoire (set.seed(42) - pour la reproductibilit√©).
- Lancement du chronom√®tre et du syst√®me de log.
- Dictionnaires et distributions
- Listes de pr√©noms masculins, f√©minins et unisexes.
- R√©partition d‚Äô√¢ge inspir√©e d‚Äôune pyramide r√©elle.
- Proportions de sexes r√©alistes (‚âà 50/50).
- Cr√©ation du tableau principal
- G√©n√©ration vectoris√©e des variables sexe et age.
- Attribution conditionnelle d‚Äôun pr√©nom selon le sexe.
- Dates et coh√©rence des √¢ges
- Calcul d‚Äôune date de naissance al√©atoire coh√©rente avec l‚Äô√¢ge.
- Recalcul exact de l‚Äô√¢ge √† partir de la date.
- Taille et niveau d‚Äô√©tudes
- Simulation de la taille selon une distribution normale (diff√©rente pour hommes et femmes).
- Attribution d‚Äôun niveau d‚Äô√©tudes d√©pendant de l‚Äô√¢ge (enfant, actif, senior).
- Export et logs
- Sauvegarde automatique en CSV et Parquet.
- Enregistrement des dur√©es et statistiques globales dans un fichier de log.


### üíæ Export des donn√©es Parquet et CSV

Les fichiers produits sont enregistr√©s dans le r√©pertoire courant :

* `population_1M.csv`
* `population_1M.parquet`

Ces formats sont directement exploitables dans **R**, **Python (pandas)**, ou tout environnement **Big Data** (Spark, Arrow‚Ä¶).


#### Nature des formats

| Format      | Type                               | Description                                                                 |
| ----------- | ---------------------------------- | --------------------------------------------------------------------------- |
| **CSV**     | Texte brut                         | Chaque ligne correspond √† un enregistrement, colonnes s√©par√©es par virgule. |
| **Parquet** | Binaire, compress√©, **colonnaire** | Stocke les donn√©es par colonne, avec typage et compression int√©gr√©s.        |


#### Principales diff√©rences

| Crit√®re                | CSV              | Parquet                                 |
| ---------------------- | ---------------- | --------------------------------------- |
| Taille du fichier      | Large            | 5‚Äì10√ó plus petit                        |
| Lecture                | Lente            | Tr√®s rapide                             |
| √âcriture               | Rapide           | Moyenne (compression)                   |
| Conservation des types | Non              | Oui                                     |
| Compatibilit√©          | Universelle      | Outils modernes (Arrow, Spark, Pandas‚Ä¶) |
| Id√©al pour             | √âchanges simples | Stockage massif et analyse rapide       |


En r√©sum√©

-  **CSV** : simple et universel, mais lent et volumineux.
- **Parquet** : compact, rapide, typ√© et pr√™t pour le Big Data ‚Äî


## Arrow vs data.table ‚Äî deux fa√ßons d‚Äôanalyser les m√™mes donn√©es

On cherche √† fournir une **vue agr√©g√©e de la population** :

* combien d‚Äôindividus ont chaque √¢ge,
* quelle est la taille moyenne et sa dispersion selon l‚Äô√¢ge,
* et si les distributions g√©n√©r√©es sont coh√©rentes.


| Colonne          | Description                                                                                                       |
| ---------------- | ----------------------------------------------------------------------------------------------------------------- |
| **`age`**        | √Çge des individus (variable de regroupement). Chaque ligne du r√©sultat correspond √† un √¢ge donn√©.                 |
| **`N`**          | Nombre d‚Äôindividus de cet √¢ge. Permet d‚Äôobserver la r√©partition de la population.                                 |
| **`moy_age`**    | Moyenne de l‚Äô√¢ge dans le groupe. Ici, elle est en pratique √©gale √† la valeur d‚Äô`age` (v√©rification de coh√©rence). |
| **`p95_age`**    | 95·µâ percentile de l‚Äô√¢ge ‚Äî indicateur de distribution utilis√© √† titre de contr√¥le.                                 |
| **`moy_taille`** | Taille moyenne (en cm) des individus ayant cet √¢ge. Permet de visualiser la croissance selon l‚Äô√¢ge.               |
| **`sd_taille`**  | √âcart-type de la taille, c‚Äôest-√†-dire la variabilit√© observ√©e au sein du groupe d‚Äô√¢ge.                            |




Une fois les fichiers export√©s, le script compare deux m√©thodes d‚Äôanalyse :

### üü¶ 1. Avec **Arrow** (`query |> collect()`)

```r
query <- DTPQ %>%
  group_by(age) %>%
  summarise(
    N          = n(),
    moy_age    = mean(age, na.rm = TRUE),
    p95_age    = quantile(age, 0.95, na.rm = TRUE),
    moy_taille = mean(taille, na.rm = TRUE),
    sd_taille  = sd(taille, na.rm = TRUE)
  )
Results_Parquet <- query |> collect()
```

- Le fichier **Parquet** est lu *√† la demande* (lazy loading).
- Le calcul est **d√©port√© dans le moteur Arrow**, sans charger toutes les donn√©es en RAM.
- Seules les colonnes n√©cessaires (`age`, `taille`) sont lues.
- Id√©al pour les tr√®s grands jeux de donn√©es (plusieurs dizaines ou centaines de millions de lignes).
- **Avantage :** ultra-rapide et √©conome en m√©moire.
- **Format :** Parquet (colonnaire, compress√©).



### üü® 2. Avec **data.table** sur le **CSV**

```r
Results_DT <- DT[ , .(
  N          = .N,
  moy_age    = mean(age, na.rm = TRUE),
  p95_age    = quantile(age, 0.95, na.rm = TRUE),
  moy_taille = mean(taille, na.rm = TRUE),
  sd_taille  = sd(taille, na.rm = TRUE)
), by = age][order(age)]
```

-Le fichier **CSV** est lu en entier dans la m√©moire (`fread`).
- Le calcul est ensuite effectu√© **enti√®rement en RAM**, via `data.table`.
- Les agr√©gations sont extr√™mement rapides, mais n√©cessitent que tout tienne en m√©moire.
- **Avantage :** tr√®s performant pour des fichiers d√©j√† charg√©s.
- **Limite :** lecture lente et forte consommation m√©moire sur de tr√®s grands fichiers.

### En r√©sum√©

| Aspect                         | `arrow` (Parquet)               | `data.table` (CSV)            |
| ------------------------------ | ------------------------------- | ----------------------------- |
| Lecture des donn√©es            | Paresseuse (lazy)               | Compl√®te en RAM               |
| Format                         | Parquet (colonnaire, compress√©) | CSV (texte brut)              |
| Colonnes lues                  | S√©lectives                      | Toutes                        |
| Calcul                         | D√©port√© (moteur Arrow)          | Local (en m√©moire)            |
| Performance sur grands volumes | ‚ö° Tr√®s bonne                    | üê¢ Limit√©e par la m√©moire     |
| Id√©al pour                     | Donn√©es massives (Big Data)     | Donn√©es locales d√©j√† charg√©es |


### Temps de traitement - Performances quasi lin√©aires

| Taille du jeu de donn√©es | G√©n√©ration | Analyse (Arrow) | Analyse (data.table) |
| ------------------------ | ---------- | --------------- | -------------------- |
| **1 M**                  | 1.0 s      | 0.1 s           | 0.2 s                |
| **10 M**                 | 8.4 s      | 0.4 s           | 2.0 s                |
| **100 M**                | 87.2 s     | 4.3 s           | 17.8 s               |


* Le temps de g√©n√©ration cro√Æt **quasiment lin√©airement** avec la taille (√ó10 lignes ‚Üí √ó8 √† √ó10 temps).
* Lecture et agr√©gation restent **tr√®s rapides** : moins de 25 secondes pour 100 millions de lignes.
* `data.table` et `arrow` offrent une **scalabilit√© remarquable** et une **utilisation m√©moire optimale**.

### üß≠ En r√©sum√©

> üîπ **Arrow + Parquet** : pour lire et agr√©ger rapidement d‚Äô√©normes volumes sans les charger int√©gralement.
> üîπ **data.table + CSV** : pour des analyses RAM rapides sur des jeux d√©j√† import√©s.

Cette comparaison met en √©vidence l‚Äôint√©r√™t de **coupler Arrow et Parquet** pour la lecture,
et **data.table** pour le calcul intensif : un duo puissant pour manipuler des donn√©es massives en R.


## Logs

```
2025-10-15 14:51:59 HST - D√©marrage du script de g√©n√©ration de donn√©es 1M... 
2025-10-15 14:51:59 HST - Chargement des pr√©noms... 
2025-10-15 14:51:59 HST - Distribution d'√¢ge g√©n√©r√©e. 
2025-10-15 14:51:59 HST - Modalit√©s de sexe d√©finies. 
2025-10-15 14:51:59 HST - G√©n√©ration de la table principale... 
2025-10-15 14:51:59 HST - Table de base cr√©√©e (1000000 lignes). 
2025-10-15 14:51:59 HST - Pr√©noms assign√©s. 
2025-10-15 14:51:59 HST - Dates de naissance et √¢ges recalcul√©s. 
2025-10-15 14:52:00 HST - Tailles g√©n√©r√©es. 
2025-10-15 14:52:00 HST - Niveau d'√©tudes assign√©. 
2025-10-15 14:52:00 HST - R√©sum√© : 1000000 individus 
2025-10-15 14:52:00 HST - √Çge moyen : 44.9 ans 
2025-10-15 14:52:00 HST - Taille moyenne : 170.9 cm 
2025-10-15 14:52:00 HST - R√©partition par sexe : Homme=49.5%, Femme=50.5% 
2025-10-15 14:52:00 HST - Export CSV termin√©. 
2025-10-15 14:52:00 HST - Conversion en tibble termin√©. 
2025-10-15 14:52:00 HST - Export Parquet termin√©. 
2025-10-15 14:52:01 HST - Dur√©e totale : 1.4 secondes 
2025-10-15 14:52:01 HST - Script termin√© avec succ√®s ‚úÖ 
2025-10-15 14:52:01 HST - D√©marrage du script d'analyse des donn√©es 1M... 
2025-10-15 14:52:01 HST - Ouverture du fichier parquet 
2025-10-15 14:52:01 HST - Lancement de arrow |> collect() 
2025-10-15 14:52:01 HST - Fin de arrow |> collect() 
2025-10-15 14:52:01 HST - Dur√©e totale : 0.1 secondes 
2025-10-15 14:52:01 HST - Ouverture du fichier parquet 
2025-10-15 14:52:01 HST - Lancement de DT[, ...] 
2025-10-15 14:52:01 HST - Fin de DT[, ...] 
2025-10-15 14:52:01 HST - Dur√©e totale : 0.3 secondes 


2025-10-15 14:52:01 HST - D√©marrage du script de g√©n√©ration de donn√©es 10M... 
2025-10-15 14:52:02 HST - Chargement des pr√©noms... 
2025-10-15 14:52:02 HST - Distribution d'√¢ge g√©n√©r√©e. 
2025-10-15 14:52:02 HST - Modalit√©s de sexe d√©finies. 
2025-10-15 14:52:02 HST - G√©n√©ration de la table principale... 
2025-10-15 14:52:02 HST - Table de base cr√©√©e (10000000 lignes). 
2025-10-15 14:52:04 HST - Pr√©noms assign√©s. 
2025-10-15 14:52:04 HST - Dates de naissance et √¢ges recalcul√©s. 
2025-10-15 14:52:06 HST - Tailles g√©n√©r√©es. 
2025-10-15 14:52:06 HST - Niveau d'√©tudes assign√©. 
2025-10-15 14:52:06 HST - R√©sum√© : 10000000 individus 
2025-10-15 14:52:06 HST - √Çge moyen : 44.8 ans 
2025-10-15 14:52:06 HST - Taille moyenne : 170.9 cm 
2025-10-15 14:52:06 HST - R√©partition par sexe : Homme=49.5%, Femme=50.5% 
2025-10-15 14:52:07 HST - Export CSV termin√©. 
2025-10-15 14:52:07 HST - Conversion en tibble termin√©. 
2025-10-15 14:52:10 HST - Export Parquet termin√©. 
2025-10-15 14:52:11 HST - Dur√©e totale : 9.5 secondes 
2025-10-15 14:52:11 HST - Script termin√© avec succ√®s ‚úÖ 
2025-10-15 14:52:11 HST - D√©marrage du script d'analyse des donn√©es 10M... 
2025-10-15 14:52:11 HST - Ouverture du fichier parquet 
2025-10-15 14:52:11 HST - Lancement de arrow |> collect() 
2025-10-15 14:52:11 HST - Fin de arrow |> collect() 
2025-10-15 14:52:11 HST - Dur√©e totale : 0.5 secondes 
2025-10-15 14:52:11 HST - Ouverture du fichier parquet 
2025-10-15 14:52:13 HST - Lancement de DT[, ...] 
2025-10-15 14:52:13 HST - Fin de DT[, ...] 
2025-10-15 14:52:13 HST - Dur√©e totale : 2.3 secondes 


2025-10-15 14:52:13 HST - D√©marrage du script de g√©n√©ration de donn√©es 100M... 
2025-10-15 14:52:13 HST - Chargement des pr√©noms... 
2025-10-15 14:52:13 HST - Distribution d'√¢ge g√©n√©r√©e. 
2025-10-15 14:52:13 HST - Modalit√©s de sexe d√©finies. 
2025-10-15 14:52:13 HST - G√©n√©ration de la table principale... 
2025-10-15 14:52:20 HST - Table de base cr√©√©e (100000000 lignes). 
2025-10-15 14:52:33 HST - Pr√©noms assign√©s. 
2025-10-15 14:52:43 HST - Dates de naissance et √¢ges recalcul√©s. 
2025-10-15 14:52:54 HST - Tailles g√©n√©r√©es. 
2025-10-15 14:53:02 HST - Niveau d'√©tudes assign√©. 
2025-10-15 14:53:02 HST - R√©sum√© : 100000000 individus 
2025-10-15 14:53:02 HST - √Çge moyen : 44.8 ans 
2025-10-15 14:53:02 HST - Taille moyenne : 170.9 cm 
2025-10-15 14:53:02 HST - R√©partition par sexe : Homme=49.5%, Femme=50.5% 
2025-10-15 14:53:10 HST - Export CSV termin√©. 
2025-10-15 14:53:12 HST - Conversion en tibble termin√©. 
2025-10-15 14:53:47 HST - Export Parquet termin√©. 
2025-10-15 14:53:47 HST - Dur√©e totale : 93.8 secondes 
2025-10-15 14:53:47 HST - Script termin√© avec succ√®s ‚úÖ 
2025-10-15 14:53:47 HST - D√©marrage du script d'analyse des donn√©es 100M... 
2025-10-15 14:53:47 HST - Ouverture du fichier parquet 
2025-10-15 14:53:48 HST - Lancement de arrow |> collect() 
2025-10-15 14:53:51 HST - Fin de arrow |> collect() 
2025-10-15 14:53:51 HST - Dur√©e totale : 4.3 secondes 
2025-10-15 14:53:51 HST - Ouverture du fichier parquet 
2025-10-15 14:54:10 HST - Lancement de DT[, ...] 
2025-10-15 14:54:14 HST - Fin de DT[, ...] 
2025-10-15 14:54:14 HST - Dur√©e totale : 22.5 secondes 
```

## üìú Licence

ü™™ **MIT License** ‚Äî libre d‚Äôutilisation, de modification et de diffusion, sous r√©serve de mention de l‚Äôauteur.

